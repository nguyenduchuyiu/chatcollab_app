<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ Thống Trò Chuyện AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
           <div class="logo">
               <i class="fas fa-robot"></i> Hệ Thống Trò Chuyện AI
           </div>
           <div class="status connecting"> <!-- Start with connecting status -->
               <i class="fas fa-circle" id="connectionStatusIcon"></i>
               <span id="statusText">Đang kết nối...</span>
           </div>
       </header>

        <div class="main-content">
            <!-- Chat Container -->
             <div class="chat-container">
                <div class="chat-messages" id="chatMessages">
                    <!-- Tin nhắn sẽ được thêm vào đây -->
                </div>
                <!-- Typing Indicator (General) -->
                <div class="typing-indicator" id="typingIndicator" style="display: none;"></div>
                <!-- Chat Input Area -->
                <div class="chat-input">
                     <div class="input-container">
                        <textarea id="userInput" placeholder="Nhập tin nhắn của bạn..." rows="1"></textarea> <!-- Start with rows=1 -->
                        <button class="send-btn" id="sendBtn" title="Gửi tin nhắn" disabled> <!-- Start disabled -->
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Info Panel -->
            <div class="info-panel">
                <!-- Progress Section (Keep as is) -->
                <div>
                    <div class="section-title"><i class="fas fa-chart-line"></i> Tiến Trình</div>
                    <div class="stage-info">
                        <div class="current-stage" id="currentStage">Khởi tạo</div>
                        <div class="stage-description" id="stageDescription">Bắt đầu cuộc trò chuyện</div>
                        <div class="stage-progress">
                            <div class="progress-container"><span>1</span> <span>2</span> <span>3</span> <span>4</span> <span>5</span></div>
                            <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width: 0%"></div></div>
                        </div>
                    </div>
                </div>

                <!-- Participants Section -->
                <div>
                    <div class="section-title">
                        <i class="fas fa-users"></i> Người Tham Gia
                    </div>
                    <ul class="participants" id="participantsList">
                        <!-- Human Participant (Fixed) - JS will update name/avatar -->
                        <li class="participant user-participant" data-agent-name="Human"> {# Keep Human initially #}
                            <div class="participant-avatar">BẠN</div> {# JS updates this #}
                            <div class="participant-info">
                                <div class="participant-name">Bạn</div> {# JS updates this #}
                                <div class="participant-status">Online</div>
                            </div>
                        </li>

                        <!-- Dynamic Agent Participants (Keep as before) -->
                        {% if participants %}
                            {% for agent in participants %}
                            {% set agent_css_name = agent.name|lower|replace('[^a-z0-9]+', '-') %}
                            <li class="participant agent-participant status-idle"
                                data-agent-id="{{ agent.id }}"
                                data-agent-name="{{ agent.name }}">
                                <div class="participant-avatar">{{ agent.avatar_initial }}</div>
                                <div class="participant-info">
                                    <div class="participant-name">{{ agent.name }}</div>
                                    <div class="participant-status">
                                        Đang hoạt động
                                        <span class="typing-dot" style="display: none;"></span>
                                    </div>
                                </div>
                            </li>
                            {% endfor %}
                        {% else %}
                            <li class="participant-empty">Không có agent nào được tải.</li>
                        {% endif %}
                    </ul>
                </div>

                <!-- Statistics Section (Keep as is) -->
                 <div>
                    <div class="section-title"><i class="fas fa-info-circle"></i> Thống Kê</div>
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-value" id="messageCount">0</div>
                            <div class="stat-label">Tin nhắn</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="turnCount">0</div>
                            <div class="stat-label">Lượt</div>
                        </div>
                    </div>
                </div>

                <!-- Controls Section (Keep as is) -->
                 <div class="controls">
                    <button class="control-btn restart" id="restartBtn" title="Bắt đầu lại cuộc trò chuyện">
                        <i class="fas fa-redo"></i> Khởi Động Lại
                    </button>
                    <button class="control-btn" id="exportBtn" title="Xuất nội dung chat">
                        <i class="fas fa-download"></i> Xuất
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Ensure script is loaded at the end -->
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>